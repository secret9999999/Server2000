From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Potrebic <jake.m.potrebic@gmail.com>
Date: Thu, 27 May 2021 18:14:55 -0700
Subject: [PATCH] Improve Piglin Barter API


diff --git a/src/main/java/org/bukkit/entity/Piglin.java b/src/main/java/org/bukkit/entity/Piglin.java
index d4cb4b0ed1d9766a87867dcf1a3a839526ba9332..74a6322521e28f7d03407643f6567cabd570cc81 100644
--- a/src/main/java/org/bukkit/entity/Piglin.java
+++ b/src/main/java/org/bukkit/entity/Piglin.java
@@ -26,6 +26,9 @@ public interface Piglin extends PiglinAbstract, InventoryHolder, com.destroystok
 
     /**
      * Adds a material to the allowed list of materials to barter with.
+     * <br>
+     * All materials returned by {@link #getBarterList()} are also considered
+     * items "Materials of Interest" that the piglins will seek out.
      *
      * @param material The material to add
      *
@@ -35,10 +38,9 @@ public interface Piglin extends PiglinAbstract, InventoryHolder, com.destroystok
 
     /**
      * Removes a material from the allowed list of materials to barter with.
-     *
-     * <strong>Note:</strong> It's not possible to override the default
-     * bartering item gold_ingots as payment. To block gold_ingots see
-     * {@link org.bukkit.event.entity.PiglinBarterEvent}.
+     * <br>
+     * <b>Note:</b> By default, piglins already barter with {@link Material#GOLD_INGOT}
+     * so you must remove that if you want to clear the barter materials.
      *
      * @param material The material to remove
      *
@@ -57,9 +59,9 @@ public interface Piglin extends PiglinAbstract, InventoryHolder, com.destroystok
 
     /**
      * Removes a material from the list of materials the piglin will pickup.
-     *
-     * <strong>Note:</strong> It's not possible to override the default list of
-     * item the piglin will pickup. To cancel pickup see
+     * <br>
+     * <b>Note:</b> By default, piglins already are interested in {@link org.bukkit.Tag#ITEMS_PIGLIN_LOVED} items
+     * and this cannot override that. To cancel pickup see
      * {@link org.bukkit.event.entity.EntityPickupItemEvent}.
      *
      * @param material The material you want removed from the interest list
@@ -71,7 +73,7 @@ public interface Piglin extends PiglinAbstract, InventoryHolder, com.destroystok
      * Returns a immutable set of materials the piglins will pickup.
      * <br>
      * <strong>Note:</strong> This set will not include the items that are set
-     * by default. To interact with those items see
+     * by default ({@link org.bukkit.Tag#ITEMS_PIGLIN_LOVED}). To interact with those items see
      * {@link org.bukkit.event.entity.EntityPickupItemEvent}.
      *
      * @return An immutable materials set
@@ -81,10 +83,9 @@ public interface Piglin extends PiglinAbstract, InventoryHolder, com.destroystok
 
     /**
      * Returns a immutable set of materials the piglins will barter with.
-     *
-     * <strong>Note:</strong> This set will not include the items that are set
-     * by default. To interact with those items see
-     * {@link org.bukkit.event.entity.PiglinBarterEvent}.
+     * <br>
+     * <strong>Note:</strong> This set will include the items that are set
+     * by default.
      *
      * @return An immutable materials set
      */
diff --git a/src/main/java/org/bukkit/event/entity/PiglinBarterEvent.java b/src/main/java/org/bukkit/event/entity/PiglinBarterEvent.java
index bd67b7cba78b9bbdd82a5a40048e658a979e3108..3e3254382b6e9fd09a767bdf7177d4a1731ce5b4 100644
--- a/src/main/java/org/bukkit/event/entity/PiglinBarterEvent.java
+++ b/src/main/java/org/bukkit/event/entity/PiglinBarterEvent.java
@@ -18,12 +18,33 @@ public class PiglinBarterEvent extends EntityEvent implements Cancellable {
     private boolean cancelled;
     private final List<ItemStack> outcome;
     private final ItemStack input;
+    private final java.util.UUID throwerUUID; // Paper
 
+    @Deprecated // Paper
     public PiglinBarterEvent(@NotNull Piglin what, @NotNull ItemStack input, @NotNull List<ItemStack> outcome) {
+        // Paper start
+        this(what, input, outcome, null);
+    }
+
+    /**
+     * Gets the UUID of the thrower of the ItemStack that caused this barter
+     * event. This could be a {@link org.bukkit.entity.Player} or an {@link org.bukkit.entity.Entity}
+     * or whatever some plugin set the thrower to via {@link org.bukkit.entity.Item#setThrower(java.util.UUID)}.
+     *
+     * @return the thrower UUID or null if none
+     */
+    @org.jetbrains.annotations.Nullable
+    public java.util.UUID getThrowerUUID() {
+        return this.throwerUUID;
+    }
+
+    public PiglinBarterEvent(@NotNull Piglin what, @NotNull ItemStack input, @NotNull List<ItemStack> outcome, @org.jetbrains.annotations.Nullable java.util.UUID throwerUUID) {
+        // Paper end
         super(what);
 
         this.input = input;
         this.outcome = outcome;
+        this.throwerUUID = throwerUUID; // Paper
     }
 
     @NotNull
